<div id="modal-backups" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; padding: 20px; align-items: center; justify-content: center;">
    <div class="modal-content" style="background: #121216; padding: 25px; border-radius: 32px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 450px; max-height: 80vh; display: flex; flex-direction: column;">
        <h3 style="margin:0; color:#3b82f6;">Histórico de Backups</h3>
        <p style="font-size: 11px; color: #888; margin-bottom: 15px;">Toque num item para restaurar a lista.</p>
        <div id="lista-backups" style="overflow-y: auto; flex-grow: 1;"></div>
        <button onclick="document.getElementById('modal-backups').style.display='none'" style="width:100%; margin-top:20px; padding:18px; border-radius:18px; background:#222; color:#fff; font-weight:bold; border:none; cursor:pointer;">FECHAR</button>
    </div>
</div>

<script>
    function abrirModalRecuperacao() {
        const modal = document.getElementById('modal-backups');
        const listaUI = document.getElementById('lista-backups');
        listaUI.innerHTML = "";
        let backupsencontrados = 0;

        for (let i = 0; i < localStorage.length; i++) {
            const chave = localStorage.key(i);
            // Procura por qualquer registo de coleta ou inventário
            if (chave.toLowerCase().includes('coleta') || chave.toLowerCase().includes('v15')) {
                try {
                    const dados = JSON.parse(localStorage.getItem(chave));
                    if (Array.isArray(dados) && dados.length > 0) {
                        backupsencontrados++;
                        const div = document.createElement('div');
                        div.style = "padding:15px; background:rgba(255,255,255,0.05); margin-bottom:10px; border-radius:15px; border:1px solid rgba(255,255,255,0.1); cursor:pointer;";
                        div.innerHTML = `<b style="color:#3b82f6;">${chave}</b><br><small style="color:#eee;">${dados.length} produtos encontrados</small>`;
                        div.onclick = () => {
                            if(confirm("Deseja restaurar os dados de: " + chave + "? Isso substituirá a lista atual.")) {
                                inventario = dados;
                                atualizarTela();
                                modal.style.display = 'none';
                            }
                        };
                        listaUI.appendChild(div);
                    }
                } catch(e) { console.error("Erro ao ler chave:", chave); }
            }
        }

        if (backupsencontrados === 0) {
            listaUI.innerHTML = "<p style='text-align:center; color:#666;'>Nenhum backup encontrado na memória deste telemóvel.</p>";
        }

        modal.style.display = 'flex'; // Abre o modal
    }
</script>
